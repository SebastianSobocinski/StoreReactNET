{"version":3,"sources":["../src/ResizeObserver.js"],"names":["style","position","left","top","right","bottom","overflow","zIndex","visibility","pointerEvents","styleChild","transition","isAncestor","node","ancestor","current","parentNode","ResizeObserver","event","props","onPosition","onReflow","onResize","_globalScollTarget","target","_refScrollTarget","_ancestorScollTarget","_reflow","Node","document","documentElement","body","HTMLElement","_expandRef","_shrinkRef","width","offsetWidth","height","offsetHeight","_lastWidth","_lastHeight","_reset","_node","Element","rect","getBoundingClientRect","sizeChanged","positionChanged","_lastRect","_removeScroll","addScrollListener","_handleScroll","_removeResize","addResizeListener","nextProps","scrollLeft","scrollTop","_handleRef","_handleExpandRef","_handleShrinkRef","length","_scrollListeners","i","call","undefined","_resizeListeners","listener","addEventListener","subscribed","push","removeScrollListener","Promise","resolve","then","splice","indexOf","removeEventListener","window","_handleResize","removeSResizeListener","React","Component"],"mappings":"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","sourcesContent":["// @flow\n/* eslint-disable complexity */\n\n// =============================================================================\n// Import modules.\n// =============================================================================\nimport React from 'react';\n\nconst style = {\n  position: 'absolute',\n  left: 0,\n  top: 0,\n  right: 0,\n  bottom: 0,\n  overflow: 'hidden',\n  zIndex: -1,\n  visibility: 'hidden',\n  pointerEvents: 'none',\n};\nconst styleChild = {\n  position: 'absolute',\n  left: 0,\n  top: 0,\n  transition: '0s',\n};\n\nfunction isAncestor(node: Node, ancestor: Node) {\n  let current = node.parentNode;\n\n  while (current) {\n    if (current === ancestor) {\n      return true;\n    }\n\n    current = current.parentNode;\n  }\n\n  return false;\n}\n\nexport type Props = {\n  onResize?: (ClientRect) => mixed,\n  onPosition?: (ClientRect) => mixed,\n  onReflow?: (ClientRect) => mixed,\n};\n\nclass ResizeObserver extends React.Component<Props> {\n  static displayName = 'ResizeObserver';\n  static _scrollListeners: Array<(event: Event) => mixed> = [];\n  static _resizeListeners: Array<(event: Event) => mixed> = [];\n\n  static _handleScroll(event: Event) {\n    const length = ResizeObserver._scrollListeners.length;\n    for (let i = 0; i < length; i++) {\n      ResizeObserver._scrollListeners[i].call(undefined, event);\n    }\n  }\n\n  static _handleResize(event: Event) {\n    const length = ResizeObserver._resizeListeners.length;\n    for (let i = 0; i < length; i++) {\n      ResizeObserver._resizeListeners[i].call(undefined, event);\n    }\n  }\n\n  static addScrollListener(listener: (event: Event) => mixed): () => void {\n    if (ResizeObserver._scrollListeners.length === 0) {\n      document.addEventListener('scroll', ResizeObserver._handleScroll, true);\n    }\n\n    let subscribed = true;\n\n    ResizeObserver._scrollListeners.push(listener);\n\n    return function removeScrollListener() {\n      if (!subscribed) return;\n\n      subscribed = false;\n\n      Promise.resolve().then(() => {\n        ResizeObserver._scrollListeners.splice(\n          ResizeObserver._scrollListeners.indexOf(listener),\n          1,\n        );\n      });\n\n      if (ResizeObserver._scrollListeners.length === 0) {\n        document.removeEventListener(\n          'scroll',\n          ResizeObserver._handleScroll,\n          true,\n        );\n      }\n    };\n  }\n\n  static addResizeListener(listener: (event: Event) => mixed): () => void {\n    if (ResizeObserver._resizeListeners.length === 0) {\n      window.addEventListener('resize', ResizeObserver._handleResize, true);\n    }\n\n    let subscribed = true;\n\n    ResizeObserver._resizeListeners.push(listener);\n\n    return function removeSResizeListener() {\n      if (!subscribed) return;\n\n      subscribed = false;\n\n      Promise.resolve().then(() => {\n        ResizeObserver._resizeListeners.splice(\n          ResizeObserver._resizeListeners.indexOf(listener),\n          1,\n        );\n      });\n\n      if (ResizeObserver._resizeListeners.length === 0) {\n        window.removeEventListener(\n          'resize',\n          ResizeObserver._handleResize,\n          true,\n        );\n      }\n    };\n  }\n\n  _expandRef: HTMLElement | null = null;\n  _shrinkRef: HTMLElement | null = null;\n  _node: HTMLElement | null = null;\n  _lastWidth: ?number;\n  _lastHeight: ?number;\n  _removeResize: ?() => void;\n  _removeScroll: ?() => void;\n  _lastRect: ClientRect;\n\n  componentDidMount() {\n    this._reflow();\n\n    this._removeScroll = ResizeObserver.addScrollListener(this._handleScroll);\n\n    if (this.props.onPosition || this.props.onReflow) {\n      this._removeResize = ResizeObserver.addResizeListener(this._reflow);\n    }\n  }\n\n  componentWillReceiveProps(nextProps: Props) {\n    if ((nextProps.onPosition || nextProps.onReflow) && !this._removeResize) {\n      this._removeResize = ResizeObserver.addResizeListener(this._reflow);\n    } else if (\n      !(nextProps.onPosition || nextProps.onReflow) &&\n      this._removeResize\n    ) {\n      this._removeResize();\n      this._removeResize = null;\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._removeScroll) {\n      this._removeScroll();\n      this._removeScroll = null;\n    }\n\n    if (this._removeResize) {\n      this._removeResize();\n      this._removeResize = null;\n    }\n  }\n\n  _handleScroll = (event: Event) => {\n    if (\n      (this.props.onPosition || this.props.onReflow || this.props.onResize) &&\n      (this._globalScollTarget(event.target) ||\n        this._refScrollTarget(event.target) ||\n        this._ancestorScollTarget(event.target))\n    ) {\n      this._reflow();\n    }\n  };\n\n  _globalScollTarget = (target: EventTarget) => {\n    return (\n      target instanceof Node &&\n      (this.props.onPosition || this.props.onReflow) &&\n      (target === document ||\n        target === document.documentElement ||\n        target === document.body)\n    );\n  };\n\n  _refScrollTarget = (target: EventTarget) => {\n    if (\n      target instanceof HTMLElement &&\n      (target === this._expandRef || target === this._shrinkRef)\n    ) {\n      const width = target.offsetWidth;\n      const height = target.offsetHeight;\n\n      if (width !== this._lastWidth || height !== this._lastHeight) {\n        this._lastWidth = width;\n        this._lastHeight = height;\n        this._reset(this._expandRef);\n        this._reset(this._shrinkRef);\n        return true;\n      }\n    }\n    return false;\n  };\n\n  _ancestorScollTarget = (target: EventTarget) => {\n    return (\n      target instanceof Node &&\n      (this.props.onPosition || this.props.onReflow) &&\n      this._node &&\n      isAncestor(this._node, target)\n    );\n  };\n\n  _reflow = () => {\n    if (!this._node || !(this._node.parentNode instanceof Element)) return;\n\n    const rect = this._node.parentNode.getBoundingClientRect();\n\n    let sizeChanged = true;\n    let positionChanged = true;\n\n    if (this._lastRect) {\n      sizeChanged =\n        rect.width !== this._lastRect.width ||\n        rect.height !== this._lastRect.height;\n\n      positionChanged =\n        rect.top !== this._lastRect.top || rect.left !== this._lastRect.left;\n    }\n\n    this._lastRect = rect;\n\n    if (sizeChanged && this.props.onResize) {\n      this.props.onResize(rect);\n    }\n\n    if (positionChanged && this.props.onPosition) {\n      this.props.onPosition(rect);\n    }\n\n    if ((sizeChanged || positionChanged) && this.props.onReflow) {\n      this.props.onReflow(rect);\n    }\n  };\n\n  _reset(node: HTMLElement | null) {\n    if (node) {\n      node.scrollLeft = 100000;\n      node.scrollTop = 100000;\n    }\n  }\n\n  _handleRef = (node: HTMLElement | null) => {\n    this._node = node;\n  };\n\n  _handleExpandRef = (node: HTMLElement | null) => {\n    this._reset(node);\n    this._expandRef = node;\n  };\n\n  _handleShrinkRef = (node: HTMLElement | null) => {\n    this._reset(node);\n    this._shrinkRef = node;\n  };\n\n  render() {\n    if (this.props.onResize || this.props.onReflow) {\n      return (\n        <div style={style} ref={this._handleRef}>\n          <div ref={this._handleExpandRef} style={style}>\n            <div style={{...styleChild, width: 100000, height: 100000}} />\n          </div>\n          <div ref={this._handleShrinkRef} style={style}>\n            <div style={{...styleChild, width: '200%', height: '200%'}} />\n          </div>\n        </div>\n      );\n    }\n\n    return <noscript ref={this._handleRef} />;\n  }\n}\n\nexport default ResizeObserver;\n"],"file":"ResizeObserver.js"}